<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/flexboxgrid.css" />
    <link rel="stylesheet" href="./css/pico.css" />
    <title>Rich ðŸ¤‘ in 2 years segÃºn W</title>
  </head>
  <body>
    <div class="container">
      <header><h1>Crypto - Rich ðŸ¤‘ in 2 years segÃºn W</h1></header>

      <main>
        <button id="get-crypto">Make me rich ðŸ¤‘</button>

        <div>
          <div class="row">
            <div class="col-xs-4">
              <label for="min-price">Min price</label>
              <input type="number" id="min-price" value="0.0001" />
            </div>
            <div class="col-xs-4">
              <label for="max-price">Max price</label>
              <input type="number" id="max-price" value="0.01" />
            </div>
            <div class="col-xs-4">
              <label for="max-supply">Max supply</label>
              <input type="number" id="max-supply" value="1000000000" />
            </div>
            <div class="col-xs-12">
              <hr />
            </div>
            <div class="col-xs-12">
              <h3>Network</h3>
              <div style="display: inline-block">
                <input type="checkbox" id="binance-smart-chain" value="binance-smart-chain" checked />
                <label for="binance-smart-chain">Binance Smart Chain</label>
              </div>
            </div>
            <div class="col-xs-12">
              <hr />
            </div>
            <div class="col-xs-12">
              <h3>Extra filters</h3>
              <label for="date-addded">Date added</label>
              <input type="date" id="date-added" value="2019-01-01" />
            </div>
          </div>
        </div>

        <div>
          <table>
            <thead>
              <tr>
                <th>#Rank</th>
                <th>Name</th>
                <th>Symbol</th>
                <th>Price</th>
                <th>Market Cap</th>
                <th>Change (24h)</th>
              </tr>
            </thead>
            <tbody id="crypto-table"></tbody>
          </table>
        </div>
      </main>
    </div>
  </body>
  <script>
    var formatter = new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
    });

    document.querySelector('#get-crypto').addEventListener('click', () => {
      fetch(`./api/crypto`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      })
        .then(async (response) => {
          if (response.ok) {
            return response.json();
          } else {
            throw await response.json();
          }
        })
        .then((data) => {
          const table = document.querySelector('#crypto-table');
          table.innerHTML = '';
          data.forEach((item) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${item.cmc_rank}</td>
              <td>${item.name}</td>
              <td>${item.symbol}</td>
              <td>USD$ ${item.quote.USD.price}</td>
              <td>${formatter.format(item.quote.USD.market_cap)}</td>
              <td>${formatter.format(item.quote.USD.volume_24h)}</td>
            `;
            table.appendChild(row);
          });
        })
        .catch((error) => {
          console.log(error);
        });
    });
  </script>
</html>
